!function e(t,n,r){function o(u,s){if(!n[u]){if(!t[u]){var c="function"==typeof require&&require;if(!s&&c)return c(u,!0);if(i)return i(u,!0);var a=new Error("Cannot find module '"+u+"'");throw a.code="MODULE_NOT_FOUND",a}var f=n[u]={exports:{}};t[u][0].call(f.exports,function(e){var n=t[u][1][e];return o(n?n:e)},f,f.exports,e,t,n,r)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(){function e(){return new o(o.Type.ALEA,{seeds:[new Date,i,u,s,Math.random()]})}var t=function(){function e(){var e=4022871197,t=function(t){t=t.toString();for(var n=0;n<t.length;n++){e+=t.charCodeAt(n);var r=.02519603282416938*e;e=r>>>0,r-=e,r*=e,e=r>>>0,r-=e,e+=4294967296*r}return 2.3283064365386963e-10*(e>>>0)};return t.version="Mash 0.9",t}return function(t){var n=0,r=0,o=0,i=1;0==t.length&&(t=[+new Date]);var u=e();n=u(" "),r=u(" "),o=u(" ");for(var s=0;s<t.length;s++)n-=u(t[s]),0>n&&(n+=1),r-=u(t[s]),0>r&&(r+=1),o-=u(t[s]),0>o&&(o+=1);u=null;var c=function(){var e=2091639*n+2.3283064365386963e-10*i;return n=r,r=o,o=e-(i=0|e)};return c.uint32=function(){return 4294967296*c()},c.fract53=function(){return c()+1.1102230246251565e-16*(2097152*c()|0)},c.version="Alea 0.9",c.args=t,c}(Array.prototype.slice.call(arguments))},n="23456789ABCDEFGHJKLMNPQRSTWXYZabcdefghijkmnopqrstuvwxyz",r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_",o=function(e,n){var r=this;if(r.type=e,!o.Type[e])throw new Error("Unknown random generator type: "+e);if(e===o.Type.ALEA){if(!n.seeds)throw new Error("No seeds were provided for Alea PRNG");r.alea=t.apply(null,n.seeds)}};o.Type={NODE_CRYPTO:"NODE_CRYPTO",BROWSER_CRYPTO:"BROWSER_CRYPTO",ALEA:"ALEA"},o.prototype.fraction=function(){var e=this;if(e.type===o.Type.ALEA)return e.alea();if(e.type===o.Type.NODE_CRYPTO){var t=parseInt(e.hexString(8),16);return 2.3283064365386963e-10*t}if(e.type===o.Type.BROWSER_CRYPTO){var n=new Uint32Array(1);return window.crypto.getRandomValues(n),2.3283064365386963e-10*n[0]}throw new Error("Unknown random generator type: "+e.type)},o.prototype.hexString=function(e){var t=this;if(t.type===o.Type.NODE_CRYPTO){var n,r=Math.ceil(e/2);try{n=nodeCrypto.randomBytes(r)}catch(i){n=nodeCrypto.pseudoRandomBytes(r)}var u=n.toString("hex");return u.substring(0,e)}return this._randomString(e,"0123456789abcdef")},o.prototype._randomString=function(e,t){for(var n=this,r=[],o=0;e>o;o++)r[o]=n.choice(t);return r.join("")},o.prototype.id=function(e){var t=this;return void 0===e&&(e=17),t._randomString(e,n)},o.prototype.secret=function(e){var t=this;return void 0===e&&(e=43),t._randomString(e,r)},o.prototype.choice=function(e){var t=Math.floor(this.fraction()*e.length);return"string"==typeof e?e.substr(t,1):e[t]};var i="undefined"!=typeof window&&window.innerHeight||"undefined"!=typeof document&&document.documentElement&&document.documentElement.clientHeight||"undefined"!=typeof document&&document.body&&document.body.clientHeight||1,u="undefined"!=typeof window&&window.innerWidth||"undefined"!=typeof document&&document.documentElement&&document.documentElement.clientWidth||"undefined"!=typeof document&&document.body&&document.body.clientWidth||1,s="undefined"!=typeof navigator&&navigator.userAgent||"";Random="undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues?new o(o.Type.BROWSER_CRYPTO):e(),Random.insecure=e()},{}],2:[function(e,t){"use strict";var n={};n.hash=function(e){e=e.utf8Encode();var t=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],r=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];e+=String.fromCharCode(128);for(var o=e.length/4+2,i=Math.ceil(o/16),u=new Array(i),s=0;i>s;s++){u[s]=new Array(16);for(var c=0;16>c;c++)u[s][c]=e.charCodeAt(64*s+4*c)<<24|e.charCodeAt(64*s+4*c+1)<<16|e.charCodeAt(64*s+4*c+2)<<8|e.charCodeAt(64*s+4*c+3)}u[i-1][14]=8*(e.length-1)/Math.pow(2,32),u[i-1][14]=Math.floor(u[i-1][14]),u[i-1][15]=8*(e.length-1)&4294967295;for(var a,f,d,l,p,h,v,m,y=new Array(64),s=0;i>s;s++){for(var g=0;16>g;g++)y[g]=u[s][g];for(var g=16;64>g;g++)y[g]=n.σ1(y[g-2])+y[g-7]+n.σ0(y[g-15])+y[g-16]&4294967295;a=r[0],f=r[1],d=r[2],l=r[3],p=r[4],h=r[5],v=r[6],m=r[7];for(var g=0;64>g;g++){var w=m+n.Σ1(p)+n.Ch(p,h,v)+t[g]+y[g],b=n.Σ0(a)+n.Maj(a,f,d);m=v,v=h,h=p,p=l+w&4294967295,l=d,d=f,f=a,a=w+b&4294967295}r[0]=r[0]+a&4294967295,r[1]=r[1]+f&4294967295,r[2]=r[2]+d&4294967295,r[3]=r[3]+l&4294967295,r[4]=r[4]+p&4294967295,r[5]=r[5]+h&4294967295,r[6]=r[6]+v&4294967295,r[7]=r[7]+m&4294967295}return n.toHexStr(r[0])+n.toHexStr(r[1])+n.toHexStr(r[2])+n.toHexStr(r[3])+n.toHexStr(r[4])+n.toHexStr(r[5])+n.toHexStr(r[6])+n.toHexStr(r[7])},n.ROTR=function(e,t){return t>>>e|t<<32-e},n.Σ0=function(e){return n.ROTR(2,e)^n.ROTR(13,e)^n.ROTR(22,e)},n.Σ1=function(e){return n.ROTR(6,e)^n.ROTR(11,e)^n.ROTR(25,e)},n.σ0=function(e){return n.ROTR(7,e)^n.ROTR(18,e)^e>>>3},n.σ1=function(e){return n.ROTR(17,e)^n.ROTR(19,e)^e>>>10},n.Ch=function(e,t,n){return e&t^~e&n},n.Maj=function(e,t,n){return e&t^e&n^t&n},n.toHexStr=function(e){for(var t,n="",r=7;r>=0;r--)t=e>>>4*r&15,n+=t.toString(16);return n},"undefined"==typeof String.prototype.utf8Encode&&(String.prototype.utf8Encode=function(){return unescape(encodeURIComponent(this))}),"undefined"==typeof String.prototype.utf8Decode&&(String.prototype.utf8Decode=function(){try{return decodeURIComponent(escape(this))}catch(e){return this}}),"undefined"!=typeof t&&t.exports&&(t.exports=n)},{}],3:[function(e){function t(e,t){CallMethod("createUser",[{username:e,password:{digest:"8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92",algorithm:"sha-256"},profile:{fullname:"匿名",icon:"/userPicture.png",anonymous:!0,browser:!0}}],t)}function n(e){localStorage.clear("savedUsername"),localStorage.clear("loginToken"),localStorage.clear("loginTokenExpires"),setTimeout(function(){autoLogin(e)},5e3)}function r(e,t,r){console.log("type: "+e+" result:"+t),"result"===e&&t&&t.token&&t.tokenExpires&&t.tokenExpires.$date?(console.log("login success"),localStorage.setItem("loginToken",t.token),localStorage.setItem("loginTokenExpires",t.tokenExpires.$date),r&&r(e,t)):(console.log("login Not Success, need retry."),n(r))}var o=window.appUtils||{};o.ddp=e("ddp.js")["default"];var i=e("./libs/sha256");e("./libs/random");var u=function(){for(var e="0123456789abcdef",t=[],n=0;36>n;n++)t[n]=Random.choice(e);t[14]="4",t[19]=e.substr(3&parseInt(t[19],16)|8,1),t[8]=t[13]=t[18]=t[23]="-";var r=t.join("");return r};const s={endpoint:ddpUrl,SocketConstructor:WebSocket},c=new o.ddp(s);var a={};window.ddp_connected=!1,window.CallMethod=function(e,t,n){if(c){var r=c.method(e,t);a[r]=n}},window.Subscribe=function(e,t,n){if(c){if(document.removeEventListener(e,n),n&&document.addEventListener(e,n,!1),t)var r=c.sub(e,t);else var r=c.sub(e,[]);return r}return-1},window.SubToCol=function(e,t,n,r){if(c){if(document.removeEventListener(t,r),r&&document.addEventListener(t,r,!1),n)var o=c.sub(e,n);else var o=c.sub(e,[]);return o}return-1},window.LoginWithEmail=function(e,t,n){CallMethod("login",[{user:{email:e},password:{digest:i.hash(t),algorithm:"sha-256"}}],n)},window.autoLogin=function(e){var n=localStorage.getItem("loginToken"),o=localStorage.getItem("loginTokenExpires");if(n&&""!==n&&o-new Date>1e4)return void CallMethod("login",[{resume:n}],function(t,n){r(t,n,e)});var i=localStorage.getItem("savedUsername");if(i&&""!==i)return void CallMethod("login",[{user:{username:i},password:{digest:"8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92",algorithm:"sha-256"}}],function(t,n){r(t,n,e)});var s=u();localStorage.setItem("savedUsername",s),t(s,function(t,n){r(t,n,e)})},c.on("connected",function(){console.log("Connected"),window.ddp_connected=!0;var e=new Event("ddpConnected");document.dispatchEvent(e)}),c.on("result",function(e){a[e.id]&&"function"==typeof a[e.id]&&(e.result?a[e.id]("result",e.result):e.error&&a[e.id]("error",e.error))}),c.on("updated",function(e){a[e.id]&&"function"==typeof a[e.id]&&a[e.id]("updated",e)}),c.on("ready",function(e){var t=new CustomEvent("subReady",{detail:e});document.dispatchEvent(t)}),c.on("added",function(e){var t=new CustomEvent(e.collection,{detail:e});document.dispatchEvent(t)}),c.on("changed",function(e){var t=new CustomEvent(e.collection,{detail:e});document.dispatchEvent(t)}),c.on("removed",function(e){var t=new CustomEvent(e.collection,{detail:e});document.dispatchEvent(t)})},{"./libs/random":1,"./libs/sha256":2,"ddp.js":4}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function b(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:b(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},a=e("wolfy87-eventemitter"),f=r(a),d=e("./queue"),l=r(d),p=e("./socket"),h=r(p),v=e("./utils"),m="1",y=["ready","nosub","added","changed","removed","result","updated","error"],g=1e4,w=function(e){function t(e){o(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return n.status="disconnected",n.autoConnect=e.autoConnect!==!1,n.autoReconnect=e.autoReconnect!==!1,n.reconnectInterval=e.reconnectInterval||g,n.messageQueue=new l["default"](function(e){return"connected"===n.status?(n.socket.send(e),!0):!1}),n.socket=new h["default"](e.SocketConstructor,e.endpoint),n.socket.on("open",function(){n.socket.send({msg:"connect",version:m,support:[m]})}),n.socket.on("close",function(){n.status="disconnected",n.messageQueue.empty(),n.emit("disconnected"),n.autoReconnect&&setTimeout(n.socket.open.bind(n.socket),n.reconnectInterval)}),n.socket.on("message:in",function(e){"connected"===e.msg?(n.status="connected",n.messageQueue.process(),n.emit("connected")):"ping"===e.msg?n.socket.send({msg:"pong",id:e.id}):v.contains(y,e.msg)&&n.emit(e.msg,e)}),n.autoConnect&&n.connect(),n}return u(t,e),s(t,[{key:"emit",value:function(){var e;setTimeout((e=c(Object.getPrototypeOf(t.prototype),"emit",this)).bind.apply(e,[this].concat(Array.prototype.slice.call(arguments))),0)}}]),s(t,[{key:"connect",value:function(){this.socket.open()}},{key:"disconnect",value:function(){this.autoReconnect=!1,this.socket.close()}},{key:"method",value:function(e,t){var n=v.uniqueId();return this.messageQueue.push({msg:"method",id:n,method:e,params:t}),n}},{key:"sub",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];return n||(n=v.uniqueId()),this.messageQueue.push({msg:"sub",id:n,name:e,params:t}),n}},{key:"unsub",value:function(e){return this.messageQueue.push({msg:"unsub",id:e}),e}}]),t}(f["default"]);n["default"]=w},{"./queue":5,"./socket":6,"./utils":7,"wolfy87-eventemitter":8}],5:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){r(this,e),this.consumer=t,this.queue=[]}return o(e,[{key:"push",value:function(e){this.queue.push(e),this.process()}},{key:"process",value:function(){if(0!==this.queue.length){var e=this.consumer(this.queue[0]);e&&(this.queue.shift(),this.process())}}},{key:"empty",value:function(){this.queue=[]}}]),e}();n["default"]=i},{}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=e("wolfy87-eventemitter"),a=r(c),f=function(e){function t(e,n){o(this,t);var r=i(this,Object.getPrototypeOf(t).call(this));return r.SocketConstructor=e,r.endpoint=n,r.rawSocket=null,r}return u(t,e),s(t,[{key:"send",value:function(e){var t=JSON.stringify(e);this.rawSocket.send(t),this.emit("message:out",JSON.parse(t))}},{key:"open",value:function(){var e=this;this.rawSocket||(this.rawSocket=new this.SocketConstructor(this.endpoint),this.rawSocket.onopen=function(){return e.emit("open")},this.rawSocket.onclose=function(){e.rawSocket=null,e.emit("close")},this.rawSocket.onerror=function(){delete e.rawSocket.onclose,e.rawSocket.close(),e.rawSocket=null,e.emit("close")},this.rawSocket.onmessage=function(t){var n;try{n=JSON.parse(t.data)}catch(r){return}e.emit("message:in",n)})}},{key:"close",value:function(){this.rawSocket&&this.rawSocket.close()}}]),t}(a["default"]);n["default"]=f},{"wolfy87-eventemitter":8}],7:[function(e,t,n){"use strict";function r(){return(i++).toString()}function o(e,t){return-1!==e.indexOf(t)}Object.defineProperty(n,"__esModule",{value:!0}),n.uniqueId=r,n.contains=o;var i=0},{}],8:[function(e,t){(function(){"use strict";function e(){}function n(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function r(e){return function(){return this[e].apply(this,arguments)}}var o=e.prototype,i=this,u=i.EventEmitter;o.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t},o.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},o.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},o.addListener=function(e,t){var r,o=this.getListenersAsObject(e),i="object"==typeof t;for(r in o)o.hasOwnProperty(r)&&-1===n(o[r],t)&&o[r].push(i?t:{listener:t,once:!1});return this},o.on=r("addListener"),o.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},o.once=r("addOnceListener"),o.defineEvent=function(e){return this.getListeners(e),this},o.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},o.removeListener=function(e,t){var r,o,i=this.getListenersAsObject(e);for(o in i)i.hasOwnProperty(o)&&(r=n(i[o],t),-1!==r&&i[o].splice(r,1));return this},o.off=r("removeListener"),o.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},o.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},o.manipulateListeners=function(e,t,n){var r,o,i=e?this.removeListener:this.addListener,u=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)i.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(o=t[r])&&("function"==typeof o?i.call(this,r,o):u.call(this,r,o));return this},o.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},o.removeAllListeners=r("removeEvent"),o.emitEvent=function(e,t){var n,r,o,i,u,s=this.getListenersAsObject(e);for(i in s)if(s.hasOwnProperty(i))for(n=s[i].slice(0),o=n.length;o--;)r=n[o],r.once===!0&&this.removeListener(e,r.listener),u=r.listener.apply(this,t||[]),u===this._getOnceReturnValue()&&this.removeListener(e,r.listener);return this},o.trigger=r("emitEvent"),o.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},o.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},o._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},o._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return i.EventEmitter=u,e},"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof t&&t.exports?t.exports=e:i.EventEmitter=e}).call(this)},{}]},{},[3]);