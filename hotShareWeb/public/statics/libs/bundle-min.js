!function e(t,n,o){function r(u,c){if(!n[u]){if(!t[u]){var s="function"==typeof require&&require;if(!c&&s)return s(u,!0);if(i)return i(u,!0);var a=new Error("Cannot find module '"+u+"'");throw a.code="MODULE_NOT_FOUND",a}var f=n[u]={exports:{}};t[u][0].call(f.exports,function(e){var n=t[u][1][e];return r(n?n:e)},f,f.exports,e,t,n,o)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<o.length;u++)r(o[u]);return r}({1:[function(){function e(){return new r(r.Type.ALEA,{seeds:[new Date,i,u,c,Math.random()]})}var t=function(){function e(){var e=4022871197,t=function(t){t=t.toString();for(var n=0;n<t.length;n++){e+=t.charCodeAt(n);var o=.02519603282416938*e;e=o>>>0,o-=e,o*=e,e=o>>>0,o-=e,e+=4294967296*o}return 2.3283064365386963e-10*(e>>>0)};return t.version="Mash 0.9",t}return function(t){var n=0,o=0,r=0,i=1;0==t.length&&(t=[+new Date]);var u=e();n=u(" "),o=u(" "),r=u(" ");for(var c=0;c<t.length;c++)n-=u(t[c]),0>n&&(n+=1),o-=u(t[c]),0>o&&(o+=1),r-=u(t[c]),0>r&&(r+=1);u=null;var s=function(){var e=2091639*n+2.3283064365386963e-10*i;return n=o,o=r,r=e-(i=0|e)};return s.uint32=function(){return 4294967296*s()},s.fract53=function(){return s()+1.1102230246251565e-16*(2097152*s()|0)},s.version="Alea 0.9",s.args=t,s}(Array.prototype.slice.call(arguments))},n="23456789ABCDEFGHJKLMNPQRSTWXYZabcdefghijkmnopqrstuvwxyz",o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_",r=function(e,n){var o=this;if(o.type=e,!r.Type[e])throw new Error("Unknown random generator type: "+e);if(e===r.Type.ALEA){if(!n.seeds)throw new Error("No seeds were provided for Alea PRNG");o.alea=t.apply(null,n.seeds)}};r.Type={NODE_CRYPTO:"NODE_CRYPTO",BROWSER_CRYPTO:"BROWSER_CRYPTO",ALEA:"ALEA"},r.prototype.fraction=function(){var e=this;if(e.type===r.Type.ALEA)return e.alea();if(e.type===r.Type.NODE_CRYPTO){var t=parseInt(e.hexString(8),16);return 2.3283064365386963e-10*t}if(e.type===r.Type.BROWSER_CRYPTO){var n=new Uint32Array(1);return window.crypto.getRandomValues(n),2.3283064365386963e-10*n[0]}throw new Error("Unknown random generator type: "+e.type)},r.prototype.hexString=function(e){var t=this;if(t.type===r.Type.NODE_CRYPTO){var n,o=Math.ceil(e/2);try{n=nodeCrypto.randomBytes(o)}catch(i){n=nodeCrypto.pseudoRandomBytes(o)}var u=n.toString("hex");return u.substring(0,e)}return this._randomString(e,"0123456789abcdef")},r.prototype._randomString=function(e,t){for(var n=this,o=[],r=0;e>r;r++)o[r]=n.choice(t);return o.join("")},r.prototype.id=function(e){var t=this;return void 0===e&&(e=17),t._randomString(e,n)},r.prototype.secret=function(e){var t=this;return void 0===e&&(e=43),t._randomString(e,o)},r.prototype.choice=function(e){var t=Math.floor(this.fraction()*e.length);return"string"==typeof e?e.substr(t,1):e[t]};var i="undefined"!=typeof window&&window.innerHeight||"undefined"!=typeof document&&document.documentElement&&document.documentElement.clientHeight||"undefined"!=typeof document&&document.body&&document.body.clientHeight||1,u="undefined"!=typeof window&&window.innerWidth||"undefined"!=typeof document&&document.documentElement&&document.documentElement.clientWidth||"undefined"!=typeof document&&document.body&&document.body.clientWidth||1,c="undefined"!=typeof navigator&&navigator.userAgent||"";Random="undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues?new r(r.Type.BROWSER_CRYPTO):e(),Random.insecure=e()},{}],2:[function(e,t){"use strict";var n={};n.hash=function(e){e=e.utf8Encode();var t=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],o=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];e+=String.fromCharCode(128);for(var r=e.length/4+2,i=Math.ceil(r/16),u=new Array(i),c=0;i>c;c++){u[c]=new Array(16);for(var s=0;16>s;s++)u[c][s]=e.charCodeAt(64*c+4*s)<<24|e.charCodeAt(64*c+4*s+1)<<16|e.charCodeAt(64*c+4*s+2)<<8|e.charCodeAt(64*c+4*s+3)}u[i-1][14]=8*(e.length-1)/Math.pow(2,32),u[i-1][14]=Math.floor(u[i-1][14]),u[i-1][15]=8*(e.length-1)&4294967295;for(var a,f,l,d,p,h,v,g,m=new Array(64),c=0;i>c;c++){for(var y=0;16>y;y++)m[y]=u[c][y];for(var y=16;64>y;y++)m[y]=n.σ1(m[y-2])+m[y-7]+n.σ0(m[y-15])+m[y-16]&4294967295;a=o[0],f=o[1],l=o[2],d=o[3],p=o[4],h=o[5],v=o[6],g=o[7];for(var y=0;64>y;y++){var w=g+n.Σ1(p)+n.Ch(p,h,v)+t[y]+m[y],b=n.Σ0(a)+n.Maj(a,f,l);g=v,v=h,h=p,p=d+w&4294967295,d=l,l=f,f=a,a=w+b&4294967295}o[0]=o[0]+a&4294967295,o[1]=o[1]+f&4294967295,o[2]=o[2]+l&4294967295,o[3]=o[3]+d&4294967295,o[4]=o[4]+p&4294967295,o[5]=o[5]+h&4294967295,o[6]=o[6]+v&4294967295,o[7]=o[7]+g&4294967295}return n.toHexStr(o[0])+n.toHexStr(o[1])+n.toHexStr(o[2])+n.toHexStr(o[3])+n.toHexStr(o[4])+n.toHexStr(o[5])+n.toHexStr(o[6])+n.toHexStr(o[7])},n.ROTR=function(e,t){return t>>>e|t<<32-e},n.Σ0=function(e){return n.ROTR(2,e)^n.ROTR(13,e)^n.ROTR(22,e)},n.Σ1=function(e){return n.ROTR(6,e)^n.ROTR(11,e)^n.ROTR(25,e)},n.σ0=function(e){return n.ROTR(7,e)^n.ROTR(18,e)^e>>>3},n.σ1=function(e){return n.ROTR(17,e)^n.ROTR(19,e)^e>>>10},n.Ch=function(e,t,n){return e&t^~e&n},n.Maj=function(e,t,n){return e&t^e&n^t&n},n.toHexStr=function(e){for(var t,n="",o=7;o>=0;o--)t=e>>>4*o&15,n+=t.toString(16);return n},"undefined"==typeof String.prototype.utf8Encode&&(String.prototype.utf8Encode=function(){return unescape(encodeURIComponent(this))}),"undefined"==typeof String.prototype.utf8Decode&&(String.prototype.utf8Decode=function(){try{return decodeURIComponent(escape(this))}catch(e){return this}}),"undefined"!=typeof t&&t.exports&&(t.exports=n)},{}],3:[function(e,t){function n(){var e,t;return t=window.navigator.userAgent.toLowerCase(),e=t.match(/MicroMessenger/i),e&&"micromessenger"===e[0]?!0:!1}function o(e){CallMethod("weshare",[postid,e])}function r(e){return console.log("wechat_sign:",e),wx.config({debug:!1,appId:e.appid,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"]})}function i(){var e,t,n=c("title"),r=c("description"),i=c("image");return console.log("desc: "+r),console.log("title: "+n),console.log("image: "+i),t={title:n,desc:n,link:window.location.href,imgUrl:i,success:function(){o("timeline"),console.log("Share success")},cancel:function(){console.log("Share cancled")}},e={title:n,desc:r,link:window.location.href,imgUrl:i,success:function(){o("chat"),console.log("Share success")},cancel:function(){console.log("Share cancled")}},wx.onMenuShareTimeline(t),wx.onMenuShareQQ(e),wx.onMenuShareWeibo(e),wx.onMenuShareAppMessage(e),wx.onMenuShareQZone(e)}function u(e){jQuery.getJSON(sign_server_url+encodeURIComponent(e),function(e){console.log("get json wechat sign data:",e);var t=e;console.log("data: "+e),r(t),wx.ready(i)})}function c(e){return document.querySelector('meta[property="og:'+e+'"').getAttribute("content")}calcPostSignature=function(e){n()&&wx&&u(e)},wechat_sign=function(){console.log("Need continue to do the sign based on url and body content, session will not working here"),calcPostSignature(window.location.href.split("#")[0])},"undefined"!=typeof t&&t.exports&&(t.exports=calcPostSignature)},{}],4:[function(e){function t(e,t){CallMethod("createUser",[{username:e,password:{digest:"8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92",algorithm:"sha-256"},profile:{fullname:"匿名",icon:"/userPicture.png",anonymous:!0,browser:!0}}],t)}function n(e){localStorage.clear("savedUsername"),localStorage.clear("loginToken"),localStorage.clear("loginTokenExpires"),setTimeout(function(){autoLogin(e)},5e3)}function o(e,t,o){console.log("type: "+e+" result:"+t),"result"===e&&t&&t.token&&t.tokenExpires&&t.tokenExpires.$date?(console.log("login success"),localStorage.setItem("loginToken",t.token),localStorage.setItem("loginTokenExpires",t.tokenExpires.$date),o&&o(e,t)):(console.log("login Not Success, need retry."),n(o))}var r=window.appUtils||{};r.ddp=e("ddp.js")["default"];var i=e("./libs/sha256");e("./libs/random"),e("./libs/wechatapi");var u=function(){for(var e="0123456789abcdef",t=[],n=0;36>n;n++)t[n]=Random.choice(e);t[14]="4",t[19]=e.substr(3&parseInt(t[19],16)|8,1),t[8]=t[13]=t[18]=t[23]="-";var o=t.join("");return o};const c={endpoint:ddpUrl,SocketConstructor:WebSocket},s=new r.ddp(c);var a={};window.ddp_connected=!1,window.CallMethod=function(e,t,n){if(s){var o=s.method(e,t);a[o]=n}},window.Subscribe=function(e,t,n){if(s){if(document.removeEventListener(e,n),n&&document.addEventListener(e,n,!1),t)var o=s.sub(e,t);else var o=s.sub(e,[]);return o}return-1},window.SubToCol=function(e,t,n,o){if(s){if(document.removeEventListener(t,o),o&&document.addEventListener(t,o,!1),n)var r=s.sub(e,n);else var r=s.sub(e,[]);return r}return-1},window.LoginWithEmail=function(e,t,n){CallMethod("login",[{user:{email:e},password:{digest:i.hash(t),algorithm:"sha-256"}}],n)},window.autoLogin=function(e){var n=localStorage.getItem("loginToken"),r=localStorage.getItem("loginTokenExpires");if(n&&""!==n&&r-new Date>1e4)return void CallMethod("login",[{resume:n}],function(t,n){o(t,n,e)});var i=localStorage.getItem("savedUsername");if(i&&""!==i)return void CallMethod("login",[{user:{username:i},password:{digest:"8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92",algorithm:"sha-256"}}],function(t,n){o(t,n,e)});var c=u();localStorage.setItem("savedUsername",c),t(c,function(t,n){o(t,n,e)})},s.on("connected",function(){console.log("Connected"),window.ddp_connected=!0;var e=new Event("ddpConnected");document.dispatchEvent(e)}),s.on("result",function(e){a[e.id]&&"function"==typeof a[e.id]&&(e.result?a[e.id]("result",e.result):e.error&&a[e.id]("error",e.error))}),s.on("updated",function(e){a[e.id]&&"function"==typeof a[e.id]&&a[e.id]("updated",e)}),s.on("ready",function(e){var t=new CustomEvent("subReady",{detail:e});document.dispatchEvent(t)}),s.on("added",function(e){var t=new CustomEvent(e.collection,{detail:e});document.dispatchEvent(t)}),s.on("changed",function(e){var t=new CustomEvent(e.collection,{detail:e});document.dispatchEvent(t)}),s.on("removed",function(e){var t=new CustomEvent(e.collection,{detail:e});document.dispatchEvent(t)})},{"./libs/random":1,"./libs/sha256":2,"./libs/wechatapi":3,"ddp.js":5}],5:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=function b(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:b(r,t,n)}if("value"in o)return o.value;var i=o.get;return void 0===i?void 0:i.call(n)},a=e("wolfy87-eventemitter"),f=o(a),l=e("./queue"),d=o(l),p=e("./socket"),h=o(p),v=e("./utils"),g="1",m=["ready","nosub","added","changed","removed","result","updated","error"],y=1e4,w=function(e){function t(e){r(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return n.status="disconnected",n.autoConnect=e.autoConnect!==!1,n.autoReconnect=e.autoReconnect!==!1,n.reconnectInterval=e.reconnectInterval||y,n.messageQueue=new d["default"](function(e){return"connected"===n.status?(n.socket.send(e),!0):!1}),n.socket=new h["default"](e.SocketConstructor,e.endpoint),n.socket.on("open",function(){n.socket.send({msg:"connect",version:g,support:[g]})}),n.socket.on("close",function(){n.status="disconnected",n.messageQueue.empty(),n.emit("disconnected"),n.autoReconnect&&setTimeout(n.socket.open.bind(n.socket),n.reconnectInterval)}),n.socket.on("message:in",function(e){"connected"===e.msg?(n.status="connected",n.messageQueue.process(),n.emit("connected")):"ping"===e.msg?n.socket.send({msg:"pong",id:e.id}):v.contains(m,e.msg)&&n.emit(e.msg,e)}),n.autoConnect&&n.connect(),n}return u(t,e),c(t,[{key:"emit",value:function(){var e;setTimeout((e=s(Object.getPrototypeOf(t.prototype),"emit",this)).bind.apply(e,[this].concat(Array.prototype.slice.call(arguments))),0)}}]),c(t,[{key:"connect",value:function(){this.socket.open()}},{key:"disconnect",value:function(){this.autoReconnect=!1,this.socket.close()}},{key:"method",value:function(e,t){var n=v.uniqueId();return this.messageQueue.push({msg:"method",id:n,method:e,params:t}),n}},{key:"sub",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?null:arguments[2];return n||(n=v.uniqueId()),this.messageQueue.push({msg:"sub",id:n,name:e,params:t}),n}},{key:"unsub",value:function(e){return this.messageQueue.push({msg:"unsub",id:e}),e}}]),t}(f["default"]);n["default"]=w},{"./queue":6,"./socket":7,"./utils":8,"wolfy87-eventemitter":9}],6:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=function(){function e(t){o(this,e),this.consumer=t,this.queue=[]}return r(e,[{key:"push",value:function(e){this.queue.push(e),this.process()}},{key:"process",value:function(){if(0!==this.queue.length){var e=this.consumer(this.queue[0]);e&&(this.queue.shift(),this.process())}}},{key:"empty",value:function(){this.queue=[]}}]),e}();n["default"]=i},{}],7:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("wolfy87-eventemitter"),a=o(s),f=function(e){function t(e,n){r(this,t);var o=i(this,Object.getPrototypeOf(t).call(this));return o.SocketConstructor=e,o.endpoint=n,o.rawSocket=null,o}return u(t,e),c(t,[{key:"send",value:function(e){var t=JSON.stringify(e);this.rawSocket.send(t),this.emit("message:out",JSON.parse(t))}},{key:"open",value:function(){var e=this;this.rawSocket||(this.rawSocket=new this.SocketConstructor(this.endpoint),this.rawSocket.onopen=function(){return e.emit("open")},this.rawSocket.onclose=function(){e.rawSocket=null,e.emit("close")},this.rawSocket.onerror=function(){delete e.rawSocket.onclose,e.rawSocket.close(),e.rawSocket=null,e.emit("close")},this.rawSocket.onmessage=function(t){var n;try{n=JSON.parse(t.data)}catch(o){return}e.emit("message:in",n)})}},{key:"close",value:function(){this.rawSocket&&this.rawSocket.close()}}]),t}(a["default"]);n["default"]=f},{"wolfy87-eventemitter":9}],8:[function(e,t,n){"use strict";function o(){return(i++).toString()}function r(e,t){return-1!==e.indexOf(t)}Object.defineProperty(n,"__esModule",{value:!0}),n.uniqueId=o,n.contains=r;var i=0},{}],9:[function(e,t){(function(){"use strict";function e(){}function n(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function o(e){return function(){return this[e].apply(this,arguments)}}var r=e.prototype,i=this,u=i.EventEmitter;r.getListeners=function(e){var t,n,o=this._getEvents();if(e instanceof RegExp){t={};for(n in o)o.hasOwnProperty(n)&&e.test(n)&&(t[n]=o[n])}else t=o[e]||(o[e]=[]);return t},r.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},r.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},r.addListener=function(e,t){var o,r=this.getListenersAsObject(e),i="object"==typeof t;for(o in r)r.hasOwnProperty(o)&&-1===n(r[o],t)&&r[o].push(i?t:{listener:t,once:!1});return this},r.on=o("addListener"),r.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},r.once=o("addOnceListener"),r.defineEvent=function(e){return this.getListeners(e),this},r.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},r.removeListener=function(e,t){var o,r,i=this.getListenersAsObject(e);for(r in i)i.hasOwnProperty(r)&&(o=n(i[r],t),-1!==o&&i[r].splice(o,1));return this},r.off=o("removeListener"),r.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},r.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},r.manipulateListeners=function(e,t,n){var o,r,i=e?this.removeListener:this.addListener,u=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(o=n.length;o--;)i.call(this,t,n[o]);else for(o in t)t.hasOwnProperty(o)&&(r=t[o])&&("function"==typeof r?i.call(this,o,r):u.call(this,o,r));return this},r.removeEvent=function(e){var t,n=typeof e,o=this._getEvents();if("string"===n)delete o[e];else if(e instanceof RegExp)for(t in o)o.hasOwnProperty(t)&&e.test(t)&&delete o[t];else delete this._events;return this},r.removeAllListeners=o("removeEvent"),r.emitEvent=function(e,t){var n,o,r,i,u,c=this.getListenersAsObject(e);for(i in c)if(c.hasOwnProperty(i))for(n=c[i].slice(0),r=n.length;r--;)o=n[r],o.once===!0&&this.removeListener(e,o.listener),u=o.listener.apply(this,t||[]),u===this._getOnceReturnValue()&&this.removeListener(e,o.listener);return this},r.trigger=o("emitEvent"),r.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},r.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},r._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},r._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return i.EventEmitter=u,e},"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof t&&t.exports?t.exports=e:i.EventEmitter=e}).call(this)},{}]},{},[4]);