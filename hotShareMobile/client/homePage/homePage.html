<template name="homePage">
  <style>
    td,th{vertical-align:middle;text-align:center;}
    td i.fa {font-size: 22px;}
    .tips-table{border:none;}
    .tips-table td{text-align: justify;}
    .tips-table td i.fa{font-size:18px;}
    .editWhatsUp{white-space: nowrap; max-width: 200px;overflow: hidden; text-overflow: ellipsis;}
    input,textarea { 
      -webkit-touch-callout: default;
      -webkit-user-select: text; 
      user-select: text;
    }
    svg line {
      shape-rendering: crispEdges;
    }
  </style>
  <div class="homePage">
      <div class="head">
        <strong class="top-home-btn active">主页</strong>
      </div>
      <div class="content">
      {{>connectionBanner}}
      <!-- status lists start -->
      <div style="margin:10px;">
        {{#if hasTwoMoreGroup}}
        {{#each myGroupWorkStatus}}
        <div class="panel panel-default">
          <div class="panel-heading">我的考勤({{group_name}})</div>
          <div style="font-weight: 400;">
            <div style="position: relative;padding: 10px 0;border: solid 1px #eee;">
              <i class="fa fa-circle " style="color: #27d496;font-size: 20px;padding: 10px;margin: auto;position: absolute;"></i>
                <div  style="display: inline-block;margin-left: 40px;font-weight: 400;">
                  <div>上班</div><div style="color: #868686">09:00</div>
                </div>
                {{#if hasIntime in_time}}
                <span style="color: #868686;padding: 10px 0;right: 60px;position: absolute;">{{inTime in_time}}</span>
                <span  class="reReckInTime" style="right: 20px;position: absolute;color: #27d496;padding: 10px 0;" data-groupid="{{group_id}}">重打</span>
                {{else}}
                <span class="checkInTime" style="color: #fff;background-color: #3db1fa;padding: 5px 10px;right: 30px;margin-top: 5px; border-radius: 5px;position: absolute;" data-groupid="{{group_id}}">未打卡</span>
                {{/if}}
            </div>
            <div style="position: relative;padding: 10px 0;">
              <i class="fa fa-circle " style="color: #f1b725;font-size: 20px;padding: 10px;margin: auto;position: absolute;"></i>
                <div  style="display: inline-block;margin-left: 40px;font-weight: 400;">
                  <div>下班</div><div style="color: #868686">18:00</div>
                </div>
                {{#if hasOutTime out_time}}
                <span style="color: #868686;padding: 10px 0;right: 60px;position: absolute;">{{outTime out_time}}</span>
                <span class="reCheckOutTime" style="right: 20px;position: absolute;color: #27d496;padding: 10px 0;" data-groupid="{{group_id}}">重打</span>
                {{else}}
                <span class="checkOutTime" style="color: #fff;background-color: #3db1fa;padding: 5px 10px;right: 30px;margin-top: 5px; border-radius: 5px;position: absolute;" data-groupid="{{group_id}}">未打卡</span>
                {{/if}}
            </div>
          </div>
        </div>
        {{/each}}
        {{else}}
        <div class="panel panel-default">
          <div class="panel-heading">我的考勤</div>
          <div style="font-weight: 400;">
            <div style="position: relative;padding: 10px 0;border: solid 1px #eee;">
              <i class="fa fa-circle " style="color: #27d496;font-size: 20px;padding: 10px;margin: auto;position: absolute;"></i>
                <div  style="display: inline-block;margin-left: 40px;font-weight: 400;">
                  <div>上班</div><div style="color: #868686">09:00</div>
                </div>
                {{#if hasIntime}}
                <span style="color: #868686;padding: 10px 0;right: 60px;position: absolute;">{{inTime}}</span>
                <span  class="reReckInTime" style="right: 20px;position: absolute;color: #27d496;padding: 10px 0;">重打</span>
                {{else}}
                <span class="checkInTime" style="color: #fff;background-color: #3db1fa;padding: 5px 10px;right: 30px;margin-top: 5px; border-radius: 5px;position: absolute;">未打卡</span>
                {{/if}}
            </div>
            <div style="position: relative;padding: 10px 0;">
              <i class="fa fa-circle " style="color: #f1b725;font-size: 20px;padding: 10px;margin: auto;position: absolute;"></i>
                <div  style="display: inline-block;margin-left: 40px;font-weight: 400;">
                  <div>下班</div><div style="color: #868686">18:00</div>
                </div>
                {{#if hasOutTime}}
                <span style="color: #868686;padding: 10px 0;right: 60px;position: absolute;">{{outTime}}</span>
                <span class="reCheckOutTime" style="right: 20px;position: absolute;color: #27d496;padding: 10px 0;">重打</span>
                {{else}}
                <span class="checkOutTime" style="color: #fff;background-color: #3db1fa;padding: 5px 10px;right: 30px;margin-top: 5px; border-radius: 5px;position: absolute;">未打卡</span>
                {{/if}}
            </div>
          </div>
        </div>
        {{/if}}
        {{#if lists}}
        {{#each lists}}
        {{#if workstatus group_id}}
        <div class="panel panel-default">
        <div id="{{group_id}}" class="panel-heading">{{group_name}}</div>
        <table class="table table-bordered">
          <thead>
              <tr role="row">
                <th>姓名</th>
                <th style="width: 60px;text-align: center;">状态</th>
                <th>进</th>
                <th>出</th>
                <th>今日简述</th>
              </tr>
            </thead>
            <tbody>
              {{#each workstatus group_id}}
              <tr>
                <td>{{person_name}}</td>
                <td>
                  {{#if isStatusIN status}}
                  <i class="fa fa-map-marker " style="color:green;"></i>
                  {{else}}
                  <i class="fa fa-map-marker " style="color:gray;"></i>
                  {{/if}}
                </td>

                {{#if isInStatusNormal in_status}}
                <!--<td><i class="fa fa-clock-o" style="color:green;"></i></td>-->
                <td>
                  {{> Template.dynamic template="svgClockIcon" data=clockDataIn }}
                </td>
                {{/if}}
                {{#if isInStatusWarning in_status}}
                <!--<td><i class="fa fa-clock-o" style="color:red;"></i></td>-->
                <td>
                  {{> Template.dynamic template="svgClockIcon" data=clockDataIn }}
                </td>
                {{/if}}
                {{#if isInStatusError in_status}}
                  {{#if isMySelf app_user_id}}
                  <td id="{{group_id}}" data-inout="in" class="modifyMyStatus"><i class="fa fa-exclamation-circle" style="color:red;"></i></td>
                  {{else}}
                  <td id="{{group_id}}" data-inout="in"><i class="fa fa-exclamation-circle" style="color:red;"></i></td>
                  {{/if}}
                {{/if}}
                {{#if isInStatusUnknown in_status}}
                <td><i class="fa fa-ellipsis-h" style="color:gray;"></i></td>
                {{/if}}

                {{#if isOutStatusNormal out_status}}
                <!--<td><i class="fa fa-clock-o" style="color:green;"></i></td>-->
                <td>
                  {{> Template.dynamic template="svgClockIcon" data=clockDataOut }}
                </td>
                {{/if}}
                {{#if isOutStatusWarning out_status}}
                <!--<td><i class="fa fa-clock-o" style="color:red;"></i></td>-->
                <td>
                  {{> Template.dynamic template="svgClockIcon" data=clockDataOut }}
                </td>
                {{/if}}
                {{#if isOutStatusError out_status}}
                  {{#if isMySelf app_user_id}}
                  <td id="{{group_id}}" data-inout="out" class="modifyMyStatus"><i class="fa fa-exclamation-circle" style="color:red;"></i></td>
                  {{else}}
                  <td id="{{group_id}}" data-inout="out"><i class="fa fa-exclamation-circle" style="color:red;"></i></td>
                  {{/if}}
                {{/if}}
                {{#if isOutStatusUnknown out_status}}
                <td><i class="fa fa-ellipsis-h" style="color:gray;"></i></td>
                {{/if}}

                {{#if isMySelf app_user_id}}
                <td class="editWhatsUp" id="{{_id}}" data-whatsup="{{whats_up}}">
                    <i class="fa fa-pencil" style="color:gray; font-size:14px;"></i>
                    {{whats_up}}
                </td>
                {{else}}
                <td>{{whats_up}}</td>
                {{/if}}
              </tr>
              {{/each}}
            </tbody>
        </table>
        </div>
        {{/if}}
        {{/each}}
        <div style="background: #e2e2e2;border-radius: 8px;padding: 10px;border: dotted 1px gray;">
          <table class="tips-table table-condensed">
            <tbody>
              <tr>
                <td style="text-align:center;"><i class="fa fa-map-marker" style="color:green;"></i></td>
                <td>在公司</td>
                <td style="text-align:center;"><i class="fa fa-map-marker" style="color:gray;"></i></td>
                <td>不在公司</td>
              </tr>
              <tr>
                <td style="text-align:center;"><i class="fa fa-clock-o" style="color:green;"></i></td>
                <td colspan="3">工作时间大于8小时 或 9:00am前上班</td>
              </tr>
              <tr>
                <td style="text-align:center;"><i class="fa fa-clock-o" style="color:red;"></i></td>
                <td colspan="3">工作时间小于8小时 或 9:00am后上班</td>
              </tr>
              <tr>
                <td style="text-align:center;"><i class="fa fa-exclamation-circle" style="color:red;"></i></td>
                <td colspan="3">记录到出但没记录到进 或 记录到两次进但没记录到出</td>
              </tr>
            </tbody>
          </table>
        </div>
        {{/if}}
      </div>
      <!-- status lists end -->

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document" style="top:50px; bottom:auto;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">编辑今日简述</h4>
      </div>
      <div class="modal-body">
        <form>
        <div class="form-group">
          <textarea id="EditorWhatsUp" rows="5"  class="form-control" placeholder="编辑今日简述" style="height: auto !important;resize: none;"></textarea>
        </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" id="" class="btn btn-primary saveWhatsUp">保存</button>
      </div>
    </div>
  </div>
</div>
<!-- Modal -->
<div class="modal fade" id="selectDevicesInOut" tabindex="-1" role="dialog" aria-labelledby="selectDevicesInOutLabel">
  <div class="modal-dialog" role="document" style="top:50px; bottom:auto;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="selectDevicesInOutLabel">选择设备</h4>
      </div>
      <div class="modal-body">
        <ul class="set-up comFadeIn">
        {{#each devices}}
          {{#if uuid}}
          <li id="{{uuid}}" class="deviceItem" style="height:60px;padding:10px 0">
              <img class="usericon" src="/device_icon_192.png" width="40" height="40" style="border-radius:4px;">
              {{#if name}}
              <label style="margin-left:48px;">{{name}}</label>
              {{else}}
              <label style="margin-left:48px;">未知设备</label>
              {{/if}}
              <div class="value" style="float:right; margin:10px;">{{in_out}}<i class="fa fa-angle-right"></i></div>
          </li>
          {{/if}}
        {{/each}}
      </ul>
      </div>
    </div>
  </div>
</div>

      </div>
  </div>
  {{> footer}}
</template>


<template name="svgClockIcon">
  <svg viewBox="0 0 34 34" style="{{style}} width:26px; height:26px;">
    <use xlink:href="#{{in_out}}-clock-icon-{{_id}}"></use>
  </svg>

    <g id="{{in_out}}-clock-icon-{{_id}}">
      <rect id="{{in_out}}-minute-hand-{{_id}}" transform="rotate(0 16 17)" x="15.386" y="6.464" width="2.0" height="11.439" />
      <rect id="{{in_out}}-hour-hand-{{_id}}" transform="rotate(0 16 17)" x="15.386" y="10.291" width="2.5" height="7.626" />

      <path stroke-width="1" style="{{pathStyle}}" d="M15.879,2.531c-8.14,0-14.739,6.599-14.739,14.739c0,8.14,6.599,14.739,14.739,14.739s14.739-6.6,14.739-14.739
      C30.618,9.13,24.02,2.531,15.879,2.531z M15.879,30.852c-7.511,0-13.6-6.089-13.6-13.6c0-7.511,6.089-13.601,13.6-13.601  c7.511,0,13.6,6.089,13.6,13.601C29.479,24.763,23.391,30.852,15.879,30.852z"
      />
    </g>
</template>