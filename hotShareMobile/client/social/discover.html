<template name="discover">
  <div class="comFadeIn discover">
    {{#if hasDiscover}}
      <!--朋友圈 start-->
      <!--
      <div class="disTop">
        <div class="disBg"></div>
        <div class="disLeft">
          <p class="disname">{{_ "Moments"}}</p>
          {{#if showSuggestPosts}}
              <p class="disdesc">{{_ "RecommendPosts"}}</p>
          {{else}}
              <p class="disdesc">{{_ "AlsoRead"}}</p>
          {{/if}}
        </div>
      </div>
      -->
      <div class="discover-top">
          <div class="discover-bg"></div>
          <div class="discover-con">
            <img src="/book-icon.png">
            <span>{{_ "RecommendReadMore"}}</span>
          </div>
      </div>
      {{> recommends}}
      {{>lpcomments}}
      {{>moments}}
      <!--朋友圈 end-->
    {{/if}}
  </div>
</template>
<template name="recommends">
    <div class="recommends">
        <ul id="wrapper">
            {{#each recommends}}
            <li class="elementBox" id="{{recommendPostId}}">
                <a id="list" class="swipeElement">
                    <div class="icon">
                        <img src="{{recommendUserIcon}}" width="40" height="40"/>
                    </div>
                    <div class="user_name">
                        <h2>{{recommendUserName}}&nbsp;
                            <span>{{_ "recommendA"}}</span>
                            <span id="{{targetPostId}}" style="color: deepskyblue">{{targetPostTitle}}</span>
                            <span>{{_ "recommendB"}}</span>
                            <span id="{{recommendPostId}}" style="color: deepskyblue">{{recommendPostTitle}}</span>
                        </h2>
                        <div class="readpost">
                            <dl>
                                <dt>
                                    <img class="post_pic" src="{{recommendPostMainImage}}" width="40" height="40"/>
                                    <div class="red_spot"></div>
                                </dt>
                                <dd>{{recommendPostTitle}}</dd>
                            </dl>
                        </div>
                        <span style="margin:0;">&nbsp;<!--{{time_diff createdAt}}--></span>
                    </div>
                    <div class="clear"></div>
                </a>
              </li>            
            {{/each}}
        </ul>
    </div>
</template>
<template name="lpcomments">
    <div class="lpcomments">
        <ul id="wrapper"  class="swipe-delete">
            {{#each lpcomments}}
                {{#if isShareFeed}}
                    <li class="elementBox">
                      <div class="behind">
                        <a href="#" class="swipeElement ui-btn delete-btn" id="{{_id}}">{{_ "delete"}}</a>
                      </div>
                      <a id="list" class="swipeElement">
                        <div class="icon">
                            <img src="{{ownerIcon}}" width="40" height="40"/>
                        </div>
                        <div class="user_name">
                            <h2>{{ownerName}}:&nbsp;<span>{{ReadAfterShare}}{{_ "PersonReadYourForward"}}</span></h2>
                            <div class="readpost">
                                <dl>
                                    <dt>
                                        <img class="post_pic" src="{{mainImage}}" width="40" height="40"/>
                                    <div class="red_spot"></div>
                                    </dt>
                                    <dd>{{postTitle}}  {{addontitle}}</dd>
                                </dl>
                            </div>
                            <span style="margin:0;">{{time_diff createdAt}}</span>
                        </div>
                        <div class="clear"></div>
                    </a>
                  </li>
                {{else}}
            <li class="elementBox">
                <div class="behind">
                  <a href="#" class="swipeElement ui-btn delete-btn" id="{{_id}}">{{_ "delete"}}</a>
                </div>
                <a id="list" class="swipeElement">
                    <div class="icon">
                        <img src="{{ownerIcon}}" width="40" height="40"/>
                    </div>
                    <div class="user_name">
                        <h2>{{ownerName}}&nbsp;<span>{{_ "AlsoComment"}}</span></h2>
                        <div class="readpost">
                            <dl>
                                <dt>
                                    <img class="post_pic" src="{{mainImage}}" width="40" height="40"/>
                                    <div class="red_spot"></div>
                                </dt>
                                <dd>{{postTitle}}  {{addontitle}}</dd>
                            </dl>
                        </div>
                        <span style="margin:0;">{{time_diff createdAt}}</span>
                    </div>
                    <div class="clear"></div>
                </a>
              </li>
                {{/if}}
            {{/each}}
        </ul>
    </div>
    <script>
      $(function() {
        function prevent_default(e) {
            e.preventDefault();
        }
        function disable_scroll() {
            $(document).on('touchmove', prevent_default);
        }
        function enable_scroll() {
            $(document).unbind('touchmove', prevent_default)
        }
        var x, elementId;
        $('body')
            .on('touchstart','.swipe-delete li > a', function(e) {
                console.log(e.originalEvent.pageX)
                $('.swipe-delete li > a.open').css('left', '0px').removeClass('open') // close em all
                $(e.currentTarget).addClass('open')
                x = e.originalEvent.targetTouches[0].pageX // anchor point
            })
            .on('touchmove','.swipe-delete li > a', function(e) {
                var change = e.originalEvent.targetTouches[0].pageX - x
                change = Math.min(Math.max(-100, change), 0) // restrict to -100px left, 0px right
                e.currentTarget.style.left = change + 'px'
                if (change < -10) disable_scroll() // disable scroll once we hit 10px horizontal slide
            })
            .on('touchend','.swipe-delete li > a', function(e) {
                var left = parseInt(e.currentTarget.style.left)
                var new_left;
                if (left < -35) {
                    new_left = '-100px'
                } else if (left > 35) {
                    new_left = '0px' //右滑动
                } else {
                    new_left = '0px'
                }
                // e.currentTarget.style.left = new_left
                $(e.currentTarget).animate({left: new_left}, 200)
                enable_scroll()
            });
        $('body').on('touchend','.swipe-delete .delete-btn', function(e) {
            e.preventDefault()
            console.log(e.currentTarget.id);
            elementId = e.currentTarget.id;
            $(this).parents('li').slideUp('fast', function() {
                $(this).remove()
                Feeds.update({_id:elementId},{$set: {checked:true}})
            })
        })
    });
    </script>
</template>
<template name="moments">
      <div class="moments">
            {{#if loading}}
                <div>{{_ "isLoading"}}</div>
            {{/if}}
            {{#if loadError}}
                <div>{{_ "FailToLoad"}}</div>
            {{/if}}
            {{#if newLayoutMoment}}
                {{#newLayoutContainer layoutId=onPostId src="moments" container=".moments"}}
                    {{#if showSuggestPosts}}
                    {{#each suggestPosts}}
                        {{#unless hideSuggestPost}}
                            {{#newLayoutElement layoutId=onPostId displayId=_id src="moments" container=".moments"}}
                                <div class="img_placeholder">
                                    <img class="mainImage" src="{{mainImage}}" />
                                </div>
    <!--                                <header>
                                  <p class="title">{{title}}</p>
                                  <p class="addontitle">{{addontitle}}</p>
                                </header>-->
                                <div class="pin_content">
    <!--                                  <span><img class="userIcon" src="{{userIcon}}" width="35" height="35" /></span>-->
                                  <p class="title">{{title}}</p>
                                  <p class="addontitle">{{addontitle}}</p>
                                  <h1 class="username">{{ownerName}}  <span>{{_ "Publish"}}</span>{{#if withSuggestAlreadyRead}}<button class="suggestAlreadyRead"><i class="fa fa-times"></i></button>{{/if}}</h1>
    <!--                                  <h2>发布了一个故事</h2>-->
    <!--                                  <b>{{time_diff createdAt}}</b>-->
                                </div>
                            {{/newLayoutElement}}
                        {{/unless}}
                    {{/each}}
                    {{/if}}
                    {{#each moments}}
                        {{#unless hidePost}}
                            {{#newLayoutElement layoutId=onPostId displayId=readPostId src="moments" container=".moments"}}
                                <div class="img_placeholder">
                                    <img class="mainImage" src="{{mainImage}}" />
                                </div>
    <!--                                <header>
                                  <p class="title">{{title}}</p>
                                  <p class="addontitle">{{addontitle}}</p>
                                </header>-->
                                <div class="pin_content">
                                  <p class="title">{{title}}</p>
                                  <p class="addontitle">{{addontitle}}</p>
    <!--                                  <span><img class="userIcon" src="{{userIcon}}" width="35" height="35" /></span>-->
    <!--                                  <h2>阅读了一个故事</h2>-->
    <!--                                  <b>{{time_diff createdAt}}</b>-->
                                </div>
                                <h1 class="username">{{username}}  <span>{{_ "readed"}}</span>{{#if withSuggestAlreadyRead}}<button class="postAlreadyRead"><i class="fa fa-times"></i></button>{{/if}}</h1>
                            {{/newLayoutElement}}
                        {{/unless}}
                    {{/each}}
                {{/newLayoutContainer}}
                {{#if isLoading}}
                    <div class="loading-spinner">
                        <div class='spinner-overlay'>
                            <div class='spinner center'>
                                <div class='spinner-blade'></div>
                                <div class='spinner-blade'></div>
                                <div class='spinner-blade'></div>
                                <div class='spinner-blade'></div>
                                <div class='spinner-blade'></div>
                                <div class='spinner-blade'></div>
                                <div class='spinner-blade'></div>
                                <div class='spinner-blade'></div>
                                <div class='spinner-blade'></div>
                                <div class='spinner-blade'></div>
                                <div class='spinner-blade'></div>
                                <div class='spinner-blade'></div>
                            </div>
                        </div>
                    </div>
                {{/if}}
            {{else}}
                <div id="wrapper">
                    {{#if showSuggestPosts}}
                        {{#each suggestPosts}}
                                <div id="list">
                                    <div class="icon">
                                        <img src="{{ownerIcon}}" width="40" height="40"/>
                                    </div>
                                    <div class="user_name">
                                        <h2>{{ownerName}}&nbsp;<span>{{_ "postedastory"}}</span></h2>
                                        <div class="readpost">
                                            <dl>
                                                <dt>
                                                    <img class="post_pic" src="{{mainImage}}" width="40" height="40"/>
                                                </dt>
                                                <dd>{{title}}  {{addontitle}}</dd>
                                            </dl>
                                        </div>
                                        <p>{{time_diff createdAt}}</p>
                                    </div>
                                    <div class="clear"></div>
                                </div>
                        {{/each}}
                    {{else}}
                        {{#each moments}}
                            {{#unless hidePost}}
                            <div id="list">
                                <div class="icon">
                                    <img src="{{userIcon}}" width="40" height="40"/>
                                </div>
                                <div class="user_name">
                                    <h2>{{username}}&nbsp;<span>{{_ "readedastory"}}</span></h2>
                                    <div class="readpost">
                                        <dl>
                                            <dt>
                                                <img class="post_pic" src="{{mainImage}}" width="40" height="40"/>
                                            </dt>
                                            <dd>{{title}}  {{addontitle}}</dd>
                                        </dl>
                                    </div>
                                    <p>{{time_diff createdAt}}</p>
                                </div>
                                <div class="clear"></div>
                            </div>
                            {{/unless}}
                        {{/each}}
                    {{/if}}
                    {{#if moreResults}}
                        <div id="showMoreMomentsResults" style="margin-left: 25px;">
                            <span class="loading">{{_ "loading"}}</span>
                        </div>
                    {{/if}}
                </div>
            {{/if}}
      </div>
</template>