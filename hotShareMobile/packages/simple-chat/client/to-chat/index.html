<template name="_simpleChatToChat">
  <div class="simple-chat">
    <div class="msg-box">
      <div class="header">
        <div class="left back"></div>
        <script type="text/javascript">
        $('.header .back').click(function(){
          SimpleChat.MsgSession.update({userId: Meteor.userId(), toUserId: location.search.replace('?id=', '')}, {$set: {count: 0}});

          var historyArr = Session.get("history_view");
          if (historyArr && historyArr.length > 0) {
            PUB.back();
          }
          else{
            Router.go('/');
          }
        })
        </script>
        <span>{{title}}</span>
        {{#if isGroups}}
          <!--<div class="right groupsProfile"></div>-->
        {{else}}
          <div class="right userProfile">
              <i class="fa fa-user"></i>
          </div>
        {{/if}}

        <!--<div class="right profile"></div>-->
        {{#if loading}}
        <div class="loading"></div>
        {{/if}}
      </div>

      <div class="box">
        <div class="face_value">
          <div class="face_top">
            人脸过滤阈值调整
          </div>
          <div class="face_foot">
            <div class="face_foota">
              <ul class="nav-pills foota_ul">
                <li><input type="checkbox" name="check" value="正脸">正脸</li>
                <li><input type="checkbox" name="check" value="左侧脸">左侧脸</li>
                <li><input type="checkbox" name="check" value="右侧脸">右侧脸</li>
              </ul>
            </div>
            <div class="face_footb">
              <div class="foot_value">&nbsp;&nbsp;阈值调整</div>
              <div class="foot_count">
                <!-- 进度条开始 -->
                <div class="progress1">
                  <div class="progress_bg">
                  <div class="progress_bar"></div>
                  </div>
                  <div class="progress_btn"></div>
              </div>
                <script>
                    var tag = false,ox = 0,left = 0,bgleft = 0;
                    var progressW = $(".progress1").width();
                    $('.progress_btn').mousedown(function(e) {
                        ox = e.pageX - left;
                        tag = true;
                    });
                    $(document).mouseup(function() {
                        tag = false;
                    });
                    $('.progress1').mousemove(function(e) {//鼠标移动
                        if (tag) {
                            left = e.pageX - ox;
                            if (left <= 0) {
                                left = 0;
                            }else if (left > progressW) {
                                left = progressW;
                            }
                            $('.progress_btn').css('left', left);
                            $('.progress_bar').width(left);
                            var nums = (left/progressW).toFixed(4);
                            $('.face_text').html(Math.floor(500 * nums));
                        }
                    });
                    $('.progress_bg').click(function(e) {//鼠标点击
                        if (!tag) {
                            bgleft = $('.progress_bg').offset().left;
                            left = e.pageX - bgleft;
                            if (left <= 0) {
                                left = 0;
                            }else if (left > progressW) {
                                left = progressW;
                            }
                            $('.progress_btn').animate({'left':left},progressW);
                            $('.progress_bar').animate({width:left},progressW);
                            var nums = (left/progressW).toFixed(4);
                            $('.face_text').html(Math.floor(500 * nums));
                        }
                    });
                </script>
                <!-- 进度条结束 -->
              </div>
              <div class="foot_num">
                <ul class="nav-pills">
                  <li class="face_text">0</li>
                  <li style="text-align: right;">500</li>
                </ul>
              </div>
            </div>
            <div class="face_footc" style="text-align: center;margin-top: 20%;">
              <p style="color: #666666;font-size:110%;">阈值调整仅在此设备有效</p>
              <button type="button" class="btn btn-primary" style="background-color:#37A7FE;font-size:150%;">确定</button>
            </div>
          </div>
        </div>
        <ul class="group-list">
          {{#each getMsg}}
            {{> _simpleChatToChatItem}}
          {{/each}}

          {{> toolsBarDown}}
          {{> toolsBarUp}}
        </ul>
        {{#if hasNewMsg}}
        <div class="hasNewMsg">
          <span>{{newMsgCount}}条新消息</span>
        </div>
        {{/if}}
      </div>

      <div class="footer"><form class="input-form">
        <div id="container"></div>
        <style type="text/css">
          #container{width: 60px; display: block;position: absolute;left: 0px;bottom: 0;height: 48px;z-index: 998;}
          #container > div{position: absolute !important;top: 0px !important;left: 0px !important;width: 60px !important;height: 48px !important;overflow: hidden !important;}
        </style>
        {{#if isNLPGroup}}
          <div class="btn-box link">
            <i class="fa fa-link" aria-hidden="true"></i>
            <div>粘贴链接</div>
          </div>
          <div class="input"><input class="input-text" type="text" placeholder="粘帖链接，进行训练" /></div>
        {{else}}
          <div class="btn-box image" id="selectfiles"></div>
          <div class="input"><input class="input-text" type="text" placeholder="说点什么" /></div>
        {{/if}}
        <div class="send-btn"><input class="btn" type="submit" value="发送" style="border-radius: 5px;" /></div>
      </form></div>
    </div>

    {{> _checkGroupDevice}}
    
    {{#if needShowTips}}
      {{> _TipHintTemplate}}
    {{/if}}
    {{#if showLNPTips}}
      {{> _LabelNewPersonTip}}
    {{/if}}
  </div>
  
  <button id="labelNewPerson">
    <img src="/label_new_person.png" width="24" />
  </button>
  {{#if inDevMode}}
  <button id="showScripts" class="">
    <i class="fa fa-code"></i>
  </button>
  <div class="scriptsLayer">
    <ul class="scriptsList">
      <li class="scriptsItem" data-script="ping">
        <i class="fa fa-bell fa-fw"></i>
        <p>Ping</p>
      </li>
      <li class="scriptsItem" data-script="clear">
        <i class="fa fa-mouse-pointer fa-fw"></i>
        <p>Clear</p>
      </li>
      <li class="scriptsItem" data-script="query">
        <i class="fa fa-search fa-fw"></i>
        <p>Query</p>
      </li>
      <li class="scriptsItem" data-script="start">
        <i class="fa fa-play fa-fw"></i>
        <p>Start</p>
      </li>
      <li class="scriptsItem" data-script="stop">
        <i class="fa fa-stop fa-fw"></i>
        <p>Stop</p>
      </li>
      <li class="scriptsItem" data-script="train">
        <i class="fa fa-anchor fa-fw"></i>
        <p>Train</p>
      </li>
      <li class="scriptsItem" data-script="startvideo">
        <i class="fa fa-play-circle fa-fw"></i>
        <p>Start Video</p>
      </li>
      <li class="scriptsItem" data-script="stopvideo">
        <i class="fa fa-pause-circle fa-fw"></i>
        <p>Stop Video</p>
      </li>
      <li class="scriptsItem" data-script="syncstatusinfo">
        <i class="fa fa-random fa-fw"></i>
        <p>Sync Status Info</p>
      </li>
      <li class="scriptsItem" data-script="finalsyncdatasets">
        <i class="fa fa-copy fa-fw"></i>
        <p>Sync Datasets</p>
      </li>
      <li class="scriptsItem" data-script="uploadlogs">
        <i class="fa fa-cloud-upload fa-fw"></i>
        <p>Upload Logs</p>
      </li>
      <li class="scriptsItem" data-script="uploadlogs">
        <i class="fa fa-face fa-fw glyphicon glyphicon glyphicon-pencil"></i>
        <p>Set the filter</p>
      </li>
    </ul>
  </div>
  {{/if}}
  <script>
      $(function(){
        $(".face_value").hide();
      })
  </script>
  <!--<script type="text/javascript" src="/packages/feiwu_simple-chat/client/lib/crypto1/crypto/crypto.js"></script>
  <script type="text/javascript" src="/packages/feiwu_simple-chat/client/lib/crypto1/hmac/hmac.js"></script>
  <script type="text/javascript" src="/packages/feiwu_simple-chat/client/lib/crypto1/sha1/sha1.js"></script>
  <script type="text/javascript" src="/packages/feiwu_simple-chat/client/lib/base64.js"></script>-->
  <!--<script type="text/javascript" src="/packages/feiwu_simple-chat/client/lib/plupload-2.1.2/js/plupload.full.min.js"></script>-->
  <!--<script type="text/javascript" src="/packages/feiwu_simple-chat/client/upload.min.js"></script>-->
</template>
<!-- message页面 点击进入的消息列表 -->
<template name="_simpleChatToChatItem">
  {{#if has_show_time}}
    {{#if show_time_str}}
      <li class="time">
        <span>{{show_time_str}}</span>
      </li>
      <!-- <li class="time">{{show_time_str}}</li> -->
    {{/if}}
  {{/if}}
  {{#if is_system_message}}
  <li id="{{_id}}"><span class="system_message">{{text}}</span></li>
  {{else}}
    <!--{{#if showUnknowMember to.id}}-->
    <li id="{{_id}}" class="{{multipleChoiceClass}} data-show-more-render {{ta_me form.id}}" data-time="{{create_time}}">
      
      <div class="icon-wrap">
        {{#if isMultipleChoice}}
          {{#if is_ta form.id}}
            <lable class="custom-checkbox-lable" for="msg-multiple-choice">
              <input name="msg-multiple-choice" type="checkbox" checked="{{checked}}">
              <div class="custom-checkbox-innerIcon"></div>
            </lable>
          {{/if}}  
        {{/if}}
        <div class="icon">
          {{> _simpleChatToChatItemIcon2}}
        </div>
        {{#if isMultipleChoice}}
          {{#if is_me form.id}}
            <lable class="custom-checkbox-lable" for="msg-multiple-choice">
              <input name="msg-multiple-choice" type="checkbox" checked="{{checked}}">
              <div class="custom-checkbox-innerIcon"></div>
            </lable>
          {{/if}}  
        {{/if}}
        </div>
      <div class="name">{{form.name}}</div>
      {{#if is_url_type}}
        <div class="url msg-content">{{text}}
          {{> _simpleChatToChatItemNLPText}}
        </div>
      {{else}}
        {{#if is_text_type type}}
          <div class="text msg-content" style="{{has_p_ids_style}}">{{{text}}}
            {{#if wait_classify}}
              <center><!-- <div>努力分析中...</div> --><i class="fa fa-spinner fa-pulse"></i></center>
            {{/if}}
            {{#if is_me form.id}}
              {{#if status_sending send_status}}
              <div class="status"><img src="/loading.gif" /></div>
              {{/if}}
              {{#if status_failed send_status}}
              <div class="status sendfiled"><img src="/failed.png" /></div>
              {{/if}}
              <!-- {{#if is_read}}
                <span class="status haveRead">已读</span>
              {{/if}} -->
            {{/if}}
            {{#if people_id}}
            <!--标记消息 start-->  
              {{#if label_complete}}
                {{#if is_error images}}
                  <div class="imgs-1-box">
                    <div class="imgs-1-item">
                      <div class="my-btn">对</div>
                      {{#each images}}
                        {{#if error}}
                        {{else}}
                          {{> _simpleChatToChatItemImg}}
                        {{/if}}
                      {{/each}}
                    </div>
                    <div class="imgs-1-item">
                      <div class="my-btn">错</div>
                      {{#each images}}
                        {{#if error}}
                          {{> _simpleChatToChatItemImg}}
                        {{/if}}
                      {{/each}}
                    </div>
                  </div>
                {{else}}
                  {{#if is_remove_label images}}
                    <div class="imgs-1-box">
                      <div class="imgs">
                        {{#each images}}
                          {{#if remove}}
                          {{else}}
                            {{> _simpleChatToChatItemImg}}
                          {{/if}}
                        {{/each}}
                      </div>
                      {{#if is_remove images}}
                        <div class="imgs-1-item">
                          <div class="my-btn">删</div>
                          {{#each images}}
                            {{#if remove}}
                              {{> _simpleChatToChatItemImg}}
                            {{/if}}
                          {{/each}}
                        </div>
                      {{/if}}
                    </div>
                  {{/if}}
                {{/if}}
                {{#if label_users}}
                  <div class="label_complete">
                    <div class="remark"><i class="fa fa-check-circle-o"></i>已完成标注</div>
                    <div class="imgs">
                      {{#each label_users}}
                        {{> _simpleChatToChatItemIcon}}
                      {{/each}}
                    </div>
                  </div>
                {{/if}}
              {{else}}
                {{#if wait_lable}}
                  {{#if is_wait_img images}}
                    <div class="imgs">
                      {{#each images}}
                        {{#if is_wait_item this}}
                          {{> _simpleChatToChatItemImg}}
                        {{/if}}
                      {{/each}}
                    </div>
                  {{/if}}
                  {{#if is_remove_label images}}
                    <div class="imgs-1-box">
                      {{#if is_label images}}
                        <div class="imgs-1-item">
                          <div class="my-btn">标</div>
                          {{#each images}}
                            {{#if label}}
                              {{> _simpleChatToChatItemImg}}
                            {{/if}}
                          {{/each}}
                        </div>
                      {{/if}}
                      {{#if is_remove images}}
                        <div class="imgs-1-item">
                          <div class="my-btn">删</div>
                          {{#each images}}
                            {{#if remove}}
                              {{> _simpleChatToChatItemImg}}
                            {{/if}}
                          {{/each}}
                        </div>
                      {{/if}}
                    </div>
                  {{/if}}
                  {{#if has_p_ids images}}
                    {{#unless hideLabelBtn to.id}}
                    <div class="label-box">
                      <div class="bottom_div">
                        <div class="wantSelectElse" style="height: auto;">标注新人</div>
                      </div>
                      <!--<div class="top_div">请点击与上图是同一个人的照片</div>-->
                      <div class="top_div">或点击与上图是同一个人的照片进行标注</div>
                      <div>
                        {{#each p_ids images}}
                          {{> _simpleChatToChatPItemImg}}
                        {{/each}}
                      </div>
                      <div class="bottom_div">
                        <!--<div class="wantSelectElse">都不是</div>-->
                        <div class="determine">确定</div>
                      </div>
                    </div>
                    {{/unless}}
                  {{else}}
                    {{#unless hideLabelBtn to.id}}
                    <div class="line-label-box crop-lable-box"><div class="check">标记</div><div class="crop">裁剪</div><div class="remove">删除</div></div>
                    {{/unless}}
                  {{/if}}
                {{else}}
                  <div class="imgs">
                    {{#each images}}
                    {{> _simpleChatToChatItemImg}}
                    {{/each}}
                  </div>
                  {{#unless hideLabelBtn to.id}}
                  <div class="line-label-box crop-lable-box"><div class="yes">对</div><div class="no">错</div><div class="no">不确定</div></div>
                  {{/unless}}
                {{/if}}
                {{#if label_users}}
                  <div class="label_complete" style="border-top:1px solid #ccc;margin-top: 10px;">
                    <div class="remark" style="color:#616161;"><i class="fa fa-check-circle-o"></i>标注过的人</div>
                    <div class="imgs">
                      {{#each label_users}}
                      <!--<img class="lazy" data-original="{{icon}}" />-->
                      {{> _simpleChatToChatItemIcon}}
                      {{/each}}
                    </div>
                  </div>
                {{/if}}
              {{/if}}
              <div class="show_more" style="display:none; position: absolute;right: -5px;top: -5px;height: 48px;line-height: 48px;left:10px;text-align: right; padding: 0;font-size: 20px; padding-right: 20px;"><i class="fa fa-angle-right"></i></div>
              {{show_images images}}
            <!--标记消息 end-->
            {{/if}}
            {{> _checkAgentMsgItem}}
          </div>
        {{else}}
          <div class="img msg-content">
            {{#if is_me form.id}}
              {{#if status_sending send_status}}
              <div class="status"><img src="/loading.gif" /></div>
              {{/if}}
              {{#if status_failed send_status}}
              <div class="status sendfiled"><img src="/failed.png" /></div>
              {{/if}}
              <!-- {{#if is_read}}
                <span class="status haveRead">已读</span>
              {{/if}} -->
            {{/if}}
            <div class="imgs">
              {{#each images}}
                <div class="img_container _close">
                {{#if url}}
                  <img class="work-ai-img swipebox lazy" data-type="images" data-peoplehisid="{{people_his_id}}" data-original="{{url}}" />
                {{else}}
                  <img class="lazy" data-original="{{thumbnail}}" />
                {{/if}}
                </div>
              {{/each}}
            </div>
            <!-- <div class="line-label-box crop-lable-box">
              <div class="check">标记</div>
              <div class="crop">裁剪</div>
              <div class="remove">删除</div>
            </div> -->
          </div>
        {{/if}}
      {{/if}}
    </li>
    <!--{{/if}}-->
  {{/if}}
</template>

<template name="_simpleChatToChatItemImg">
  {{#if isVideo}}
  <div class="video_container video-click-able"  id="{{id}}" data-imgurl="{{url}}" data-videosrc="{{video_src}}">
    <img class="lazy" data-original="{{url}}" />
    <div class="video-play-tip"><img src="/music_pic_default.png"/> </div>
  </div>
  {{else}}
  <div class="img_container _close {{eventType}}">
    <img class="work-ai-img swipebox lazy" data-type="images" data-peoplehisid="{{people_his_id}}" data-original="{{url}}" />
    {{#if hasAccAndFuzz}}
    <div class="value_bg"><div class="accuracy">{{accuracy}}</div><div class="fuzziness">{{fuzziness}}</div></div>
    {{/if}}
  </div>
  {{/if}}
</template>

<template name="_simpleChatToChatPItemImg">
  <div class="img_container p_imgBg">
    <img class="work-ai-img lazy" data-type="images" data-pname="{{name}}"  data-original="{{url}}" />
    {{#if name}}
    <div class="value_bg">
      <div class="person_name">{{name}}</div>
    </div>
    {{/if}}
  </div>
</template>

<template name="_simpleChatToChatItemIcon">
  <img class="lazy" data-original="{{icon}}" />
</template>
<template name="_simpleChatToChatItemIcon2">
  <img class="lazy" data-original="{{form.icon}}" />
</template>

<template name="_simpleChatToChatItemThumbData">
  <img class="lazy" data-original="{{thumbData}}" />
</template>


<template name="_simpleChatToChatLabelBox">
  <div class="simple-chat-label-box">
    <div class="mask"></div>
    <div class="_body">
      <div class="title">{{title}}</div>
      <div class="_main">
        {{#if list}}
        <select>
          <optgroup disabled hidden></optgroup>
          {{#each list}}
          <option value="{{this}}">{{this}}</option>
          {{/each}}
          <option value="">其它</option>
        </select>
        <input style="display: none;" type="text" placeholder="{{tips}}" />
        {{else}}
        <div class="dest">{{tips}}</div>
        {{/if}}
      </div>
      <div class="btns">
        {{#each btns}}
        <div class="my-btn">{{this}}</div>
        {{/each}}
      </div>
    </div>
  </div>
</template>

<template name="_simpleChatToChatLabel">
  <div class="simple-chat-label">
    {{#if data.label}}
    <div class="btn-label">此照片是 {{data.label}} 吗？</div>
    {{else}}
    <div class="btn-label yes">我想标记此照片</div>
    {{/if}}
    {{#if data.label}}
    <div class="btn-yes"><i class="fa fa-circle-o" aria-hidden="true"></i><i class="fa fa-check" aria-hidden="true"></i></div>
    <div class="btn-no"><i class="fa fa-circle-o" aria-hidden="true"></i><i class="fa fa-close" aria-hidden="true"></i></div>
    {{else}}
    <div class="btn-no" style="top: 5px;"><i class="fa fa-circle-o" aria-hidden="true"></i><i class="fa fa-close" aria-hidden="true"></i></div>
    {{/if}}
  </div>
</template>


<template name="_simleChatToSwipeBox">
  <div class="simple-chat-swipe-box">
    {{#if hasAccAndFuzz}}
    <div class="swipe_value_bg">
      <div class="swipe_accuracy">
        <span>准确度:</span>{{data.accuracy}}
      </div>
      <div class="swipe_fuzziness">
        <span>模糊度:</span>{{data.fuzziness}}
      </div>
    </div>
    {{/if}}
  </div>
</template>

<template name="_checkAgentMsgItem">
  {{#if is_agent_check}}
  <div class="agentItem">
    <div class="imgs">
      {{#each images}}
        {{> _simpleChatToChatItemImg}}
      {{/each}}
      <div class="time_box">
        {{#if hadReCheck}}
        <div>{{is_up_down}}时间：</div>
        <div style="margin-left: 10px">
          <div>
            {{#if is_right}}
            <i class="fa fa-check" aria-hidden="true" style="color: #35afd8;"></i>
            {{else}}
            {{#if reCheckTime}}
            <i class="fa fa-close" aria-hidden="true" style="color: red; padding-right: 4px;"></i>
            {{/if}}
            {{/if}}
            {{fomat_time}}
          </div>
          {{#if reCheckTime}}
            <div>
              <i class="fa fa-check" aria-hidden="true" style="color: #35afd8;"></i>
              {{fomat_time reCheckTime}}
            </div>
          {{/if}}
        </div>
        {{/if}}
      </div>
    </div>
    {{#if hadReCheck}}
    {{else}}
    <div class="line-label-box"><div class="is_right">确认</div><div class="is_error">修改</div></div>
    {{/if}}
  </div>
  {{/if}}
</template>

<template name="_checkGroupDevice">
<div class="_checkGroupDevice">
  <div class="_cgd_container">
    <div class="_cgd_header">
      <h1 class="_cgd_title">选择设备</h1>
      <button class="_cgd_close"><i class="fa fa-close fa-fw"></i></button>
    </div>
    <ul class="_cgd_device_lists">
      {{#each lists}}
      <li class="_cgd_device_item">{{name}}</li>
      {{/each}}
    </ul>
  </div>
</div>
</template>
